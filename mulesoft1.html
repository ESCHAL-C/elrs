<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>mulesoft eLRS Front End - without jQuery</title>

<script>
</script>

<style>
  .calculator {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: flex-start;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .multi-input {
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    justify-content: flex-start;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .singleinput {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: flex-start;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .label, .textentry, .textecho {
    padding: 5px;
    margin-top: 10px;
    text-align: left;
  }

  .label {
    width: 200px;
  }

  .textentry, .textecho {
    width: 100px;
  }

  .resultsbtn {
    width: 200px;
  }



</style>
</head>
<body>

  <h1>eLRS Front End Demo</h1>
  <p>This eLRS tool can accept coordinates in four different formats:</p>
    <ul>
      <li>Lat, Lon</li>
      <li>RouteID (Route Name), Reference Marker, and Displacement</li>
      <li>RouteID (Route Name), And Distance from Origin</li>
      <li>CSJ And Mile Point Measure</li>
    </ul>

  <p>NOTE: This webpage does not have any data validation for text fields yet.</p>
  <a href="usingjquery.html">eLRS Front End with jQuery</a>

  <p id="p_returned_ROUTEID" class="textecho">FOO</p>

  <div class="calculator">
    <form style = "flex-basis: 40%;">
        <div class="multi-input">
          <h2>Query by Lat Lon</h2>
          <p>Example: Lat=29.39780972 Lon=-94.98759004</p>
          <div class="singleinput">
            <label for="lat" class="label">Latitude:</label>
            <input type="text" id="lat" name="lat" class="textentry">
            <p id="show_lat" class="textecho"></p>
          </div>
          <div class="singleinput">
            <label for="lon" class="label">Longitude:</label>
            <input type="text" id="lon" name="lon" class="textentry">
            <p id="show_lon" class="textecho"></p>
          </div>
          <br><button type="button" onclick="myFunction111()" class="resultsbtn">Return Results</button><br><br>
          <a href="" id="elrs1_url" class="erls_url"></a>
        </div>
    </form>

    <p id="p_returned_ROUTEID" class="textecho">FOO</p>
  </div>

  <script>
    function myFunction1() {
        var lat = document.getElementById("lat").value;
        document.getElementById("show_lat").innerHTML = lat;
        var lon = document.getElementById("lon").value;
        document.getElementById("show_lon").innerHTML = lon;

        var basepath = "https://grid-sys.us-e1.cloudhub.io/api/"
        var elrs1 = basepath + "elrs1?Lat=" + lat + "&Lon=" + lon

        document.getElementById("elrs1_url").innerHTML=elrs1;
        document.getElementById("elrs1_url").href=elrs1;
        document.getElementById("elrs_frame").src=elrs1;
    }

    function myFunction11() {
        var lat = document.getElementById("lat").value;
        document.getElementById("show_lat").innerHTML = lat;
        var lon = document.getElementById("lon").value;
        document.getElementById("show_lon").innerHTML = lon;

        var mulepath = "https://anypoint.mulesoft.com/mocking/api/v1/sources/exchange/assets/b42f4441-6b1f-448b-a136-2b6b52280e5a/grid-sys/1.0.9/m/"
        var mule_elrs1 = mulepath + "elrs1?Lat=" + lat + "&Lon=" + lon

        document.getElementById("elrs1_url").innerHTML=mule_elrs1;
        document.getElementById("elrs1_url").href=mule_elrs1;

        var request = new XMLHttpRequest();
        console.log("new XMLHttpRequest");
        request.open('GET', mule_elrs1, true);
        request.onload = function () {
          var data = JSON.parse(this.response);
          console.log(data);
          console.log(request.status);
          if (request.status >= 200 && request.status < 400) {
            data.forEach(point => {
              var returned_ROUTEID = point.ROUTEID;
              console.log(returned_ROUTEID);
              document.getElementById("p_returned_ROUTEID").innerHTML=returned_ROUTEID;
            });
          };
        };
    }

    function myFunction111() {

        async function getELRS1() {
            var lat = document.getElementById("lat").value;
            document.getElementById("show_lat").innerHTML = lat;
            var lon = document.getElementById("lon").value;
            document.getElementById("show_lon").innerHTML = lon;

            var mulepath = "https://anypoint.mulesoft.com/mocking/api/v1/sources/exchange/assets/b42f4441-6b1f-448b-a136-2b6b52280e5a/grid-sys/1.0.9/m/"
            var mule_elrs1 = mulepath + "elrs1?Lat=" + lat + "&Lon=" + lon

            document.getElementById("elrs1_url").innerHTML=mule_elrs1;
            document.getElementById("elrs1_url").href=mule_elrs1;

            let url = mule_elrs1;
            try {
                let res = await fetch(url);
                return await res.json();
            } catch (error) {
                console.log(error);
            }
        }

        async function renderELRS1() {
            let results = await getELRS1();
            let html = '';
            results.forEach(result => {
                let htmlSegment = `<div class="result">
                                    <h2>${result.ROUTEID}</h2>
                                </div>`;
                html += htmlSegment;
            });

            let container = document.querySelector('.container');
            document.getElementById("p_returned_ROUTEID").innerHTML = html;
        }

        renderELRS1();

      }













//https://stackoverflow.com/questions/4728520/get-innerhtml-from-external-page-with-javascript

//https://grid-sys.us-e1.cloudhub.io/api/elrs1?Lat=29.39780972&Lon=-94.98759004
//https://grid-sys.us-e1.cloudhub.io/api/elrs2?RouteID=IH0010-KG&ReferenceMarker=476&Displacement=4
//https://grid-sys.us-e1.cloudhub.io/api/elrs3?ControlSectionNumber=LY7609&MilePointMeasure=.2
//https://grid-sys.us-e1.cloudhub.io/api/elrs4?RouteID=IH0010-KG&DistanceFromOrigin=.5


  </script>


</body>
</html>
